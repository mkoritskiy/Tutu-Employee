# Руководство по использованию Mock API

## Обзор

В проекте реализована система моков для API, которая позволяет разрабатывать и тестировать UI без
необходимости подключения к реальному backend.

## Переключение между Mock и Real API

Для переключения между моковыми данными и реальным API используйте константу `USE_MOCK_API` в файле
`NetworkModule.kt`:

```kotlin
// composeApp/src/commonMain/kotlin/ru/tutu/tutuemployee/di/NetworkModule.kt

const val USE_MOCK_API = true  // Использовать моки
// const val USE_MOCK_API = false  // Использовать реальный API
```

## Архитектура

### Интерфейс ApiService

Определяет контракт для всех API операций:

```kotlin
interface ApiService {
    suspend fun login(username: String, password: String): Result<AuthResponse>
    suspend fun getCurrentUser(): Result<UserDto>
    suspend fun getNews(): Result<List<NewsDto>>
    // ... другие методы
}
```

### Реализации

1. **ApiServiceImpl** - реальная реализация с HTTP запросами через Ktor Client
2. **MockApiService** - мок-реализация с тестовыми данными

## Возможности MockApiService

### 1. Симуляция сетевой задержки

По умолчанию добавляется задержка 500ms для имитации реальных сетевых запросов:

```kotlin
private val networkDelay = 500L
```

### 2. Динамическое состояние

Mock API поддерживает состояние для некоторых операций:

- **Избранное**: можно добавлять и удалять карточки
- **Бонусные баллы**: уменьшаются при покупке мерча
- **Генерация ID**: автоматическая генерация уникальных ID

### 3. Валидация

Mock API выполняет базовую валидацию:

- Проверка логина/пароля при авторизации
- Проверка наличия баллов при покупке мерча
- Фильтрация результатов при поиске сотрудников

## Тестовые данные

### Пользователи

**Текущий пользователь:**

- Имя: Иван Иванов
- Email: ivan.ivanov@tutu.ru
- Должность: Senior Android Developer
- Доступные дни отпуска: 14
- Бонусные баллы: 500

**Список сотрудников (5 человек):**

- Мария Петрова (HR Manager)
- Алексей Сидоров (Senior Backend Developer)
- Елена Смирнова (UI/UX Designer)
- Дмитрий Козлов (Product Manager)
- Анна Волкова (QA Engineer)

### Новости

4 новости разных категорий:

- Новости компании
- События
- Офис

### Дни рождения

3 ближайших дня рождения сотрудников

### Профиль

- **Достижения**: 3 достижения
- **Задачи**: 4 задачи (TODO, IN_PROGRESS, DONE)
- **Отпуска**: 3 отпуска (запланированные, одобренные)
- **Курсы**: 4 курса с разным прогрессом

### Офис

- **Рабочие места**: 5 мест на разных этажах
- **Новости офиса**: 3 новости

### Мерч

8 товаров разных категорий:

- Одежда (футболка, худи)
- Аксессуары (рюкзак, термокружка)
- Канцелярия (блокнот, стикеры)
- Электроника (мышь, флешка)

### Избранное

4 карточки по умолчанию:

- Jira
- Confluence
- GitLab
- Корпоративный портал

## Авторизация

Mock API принимает любую пару логин/пароль (оба поля не должны быть пустыми):

```kotlin
// Успешная авторизация
login("any_username", "any_password")

// Ошибка ��вторизации
login("", "") // пустые значения
```

## Поиск сотрудников

Поиск выполняется по полям:

- Имя
- Фамилия
- Должность
- Отдел

Поиск регистронезависимый.

## Покупка мерча

При покупке мерча:

1. Проверяется наличие товара
2. Проверяется достаточность баллов
3. При успехе баллы списываются

```kotlin
// У пользователя 500 баллов
purchaseMerchItem("merch_1") // Футболка за 100 баллов - успех
// Теперь у пользователя 400 баллов
```

## Работа с избранным

Избранное хранится в памяти:

```kotlin
// Получить список (при первом вызове загружаются дефолтные карточки)
getFavorites()

// Добавить новую карточку
addFavorite("My Tool", "https://tool.example.com")

// Удалить карточку
deleteFavorite("fav_1")
```

## Настройка моковых данных

Для изменения тестовых данных отредактируйте методы в `MockApiService.kt`:

- `getMockUser()` - данные текущего пользователя
- `getMockNewsList()` - список новостей
- `getMockEmployees()` - список сотрудников
- `getMockAchievements()` - достижения
- `getMockTasks()` - задачи
- `getMockVacations()` - отпуска
- `getMockCourses()` - курсы
- `getMockWorkspaceBookings()` - рабочие места
- `getMockOfficeNews()` - новости офиса
- `getMockMerchItems()` - товары мерча
- `getDefaultFavorites()` - избранное по умолчанию

## Изменение задержки сети

Для более быстрого тестирования можно уменьшить или убрать задержку:

```kotlin
class MockApiService : ApiService {
    // Уменьшить задержку
    private val networkDelay = 100L
    
    // Или убрать совсем
    // private val networkDelay = 0L
}
```

## Преимущества использования моков

1. **Быстрая разработка UI** - не нужно ждать готовности backend
2. **Автономная работа** - разработка без интернета
3. **Предсказуемые данные** - всегда одинаковый набор для тестирования
4. **Тестирование edge cases** - легко добавить специфичные сценарии
5. **Демонстрация** - можно показывать работу приложения без backend

## Переход на реальный API

Когда backend будет готов:

1. Установите `USE_MOCK_API = false` в `NetworkModule.kt`
2. Укажите правильный URL в `DefaultRequest`
3. Проверьте маппинг DTO (моки используют те же DTO, что и реальный API)

## Отладка

При использовании моков в логах будет видно:

```
// Логирование через Ktor будет отключено
// Но можно добавить логи в MockApiService для отладки

override suspend fun getNews(): Result<List<NewsDto>> {
    println("MockApiService: Fetching news")
    delay(networkDelay)
    return Result.success(getMockNewsList())
}
```

## Расширение моков

Для добавления новых данных:

1. Добавьте метод в интерфейс `ApiService`
2. Реализуйте его в `ApiServiceImpl` (реальный API)
3. Реализуйте его в `MockApiService` (мок данные)
4. Добавьте приватный метод-генератор данных, если нужно

Пример:

```kotlin
// В ApiService
interface ApiService {
    suspend fun getProjects(): Result<List<ProjectDto>>
}

// В MockApiService
override suspend fun getProjects(): Result<List<ProjectDto>> {
    delay(networkDelay)
    return Result.success(getMockProjects())
}

private fun getMockProjects(): List<ProjectDto> {
    return listOf(
        ProjectDto(
            id = "proj_1",
            name = "Mobile App",
            description = "iOS and Android app"
        )
    )
}
```

## Известные ограничения

1. Состояние сбрасывается при перезапуске приложения
2. Нет сохранения в локальное хранилище
3. Некоторые операции могут отличаться от реального API (например, валидация)
4. Изображения используют placeholder сервисы (pravatar.cc, picsum.photos)

## Рекомендации

1. Используйте моки на начальных этапах разработки
2. Периодически тестируйте с реальным API
3. Держите мок данные актуальными с реальной структурой
4. Добавляйте разнообразные данные для тестирования разных UI состояний
5. Документируйте изменения в мок данных
